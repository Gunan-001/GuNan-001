<?xml version="1.0" encoding="UTF8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.small.fruitandvagetablemallspringboot.dao.OrderDetailMapper">

    <select id="queryAllDetailNum" resultType="string">
        select od.ordernumber from order_detail od;
    </select>


    <!-- 根据ID查询订单详情 -->
    <select id="selectOrderDetailById" resultType="com.small.fruitandvagetablemallspringboot.pojo.OrderDetail"
            parameterType="java.lang.Integer">
        SELECT
            id,
            addressId,
            userId,
            orderPay,
            commodityPrice,
            orderStatus,
            orderNumber,
            orderDetail,
            orderTime
        FROM
            order_detail
        WHERE
            id = #{id}
    </select>

    <!-- 根据订单编号查询订单详情 -->
    <select id="selectOrderDetailByOrderNumber" resultType="com.small.fruitandvagetablemallspringboot.pojo.OrderDetail"
            parameterType="java.lang.String">
        SELECT
            id,
            addressId,
            userId,
            orderPay,
            commodityPrice,
            orderStatus,
            orderNumber,
            orderDetail,
            orderTime
        FROM
            order_detail
        WHERE
            orderNumber = #{orderNumber}
    </select>

    <select id="queryForOrderDetailInformationById" parameterType="int"  resultType="hashMap">
        SELECT
            od.*,
            pi.nickName,
            pi.userName,
            pi.userPhone,
            pi.userSex,
            pi.userStatus,
            ad.shoppingDefault,
            ad.shoppingName,
            ad.shoppingPhone,
            ad.shoppingAddress
        FROM
            order_detail od
                LEFT JOIN personal_information pi ON od.userId = pi.id
                LEFT JOIN shopping_address ad ON od.addressId = ad.id where pi.id=#{uid} order by od.orderStatus asc ,
                                                                                                  od.orderTime desc ;
    </select>

    <select id="queryForOrderDetailInformationByOrderId" resultType="hashMap">
        SELECT
            od.*,
            pi.nickName,
            pi.userName,
            pi.userPhone,
            pi.userSex,
            pi.userStatus,
            ad.shoppingDefault,
            ad.shoppingName,
            ad.shoppingPhone,
            ad.shoppingAddress
        FROM
            order_detail od
                LEFT JOIN personal_information pi ON od.userId = pi.id
                LEFT JOIN shopping_address ad ON od.addressId = ad.id where od.id=#{id} order by od.orderStatus asc ,
                                                                                                 od.orderTime desc;
    </select>
    <select id="queryForOrderDetailInfoAndPersonInfo"  resultType="hashMap">
        SELECT
            od.*,
            pi.nickName,
            pi.userName,
            pi.userPassword,
            pi.userPhone,
            pi.userSex,
            pi.userStatus,
            ad.shoppingDefault,
            ad.shoppingName,
            ad.shoppingPhone,
            ad.shoppingAddress
        FROM
            order_detail od
                LEFT JOIN personal_information pi ON od.userId = pi.id
                LEFT JOIN shopping_address ad ON od.addressId = ad.id order by od.orderStatus asc ,
                                                                               od.orderTime desc
    </select>


    <insert id="addOrderDetailInfo" parameterType="orderDetail" keyProperty="id" useGeneratedKeys="true">
        insert into order_detail(addressId,userId,orderPay,commodityPrice,orderStatus,orderNumber,orderDetail,orderTime) VALUES
        (#{addressId},#{userId},#{orderPay},#{commodityPrice},0,#{orderNumber},#{orderDetail},now())

    </insert>

    <update id="updateOrderDetailInfoById" parameterType="orderDetail">
        update order_detail
        <set>
            <if test="''!=orderStatus and null!=orderStatus">
                orderStatus=#{orderStatus},
            </if>
        </set>
        where id=#{id}
    </update>

    <delete id="deleteOrderDetailInfoById" parameterType="int">
        delete from order_detail where id =#{id}
    </delete>
</mapper>