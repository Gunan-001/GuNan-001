<?xml version="1.0" encoding="UTF8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.small.fruitandvagetablemallspringboot.dao.MessageBoardMapper">
    <select id="queryForMessageBoardById" parameterType="int"  resultType="hashMap">
        SELECT
            mb.*,pi.nickName,
            pi.userName,
            pi.userPassword,
            pi.userPhone,
            pi.userSex,
            pi.userStatus
        FROM
            message_board mb
                LEFT JOIN personal_information pi ON mb.userId = pi.id
        where pi.id=#{id};
    </select>

    <select id="queryForMessageBoard"  resultType="hashMap">
        SELECT
            mb.*,pi.nickName,
            pi.userName,
            pi.userPhone,
            pi.userSex,
            pi.userStatus
        FROM
            message_board mb
                LEFT JOIN personal_information pi ON mb.userId = pi.id
    </select>


    <select id="queryForMessageBoardLimit" resultType="hashMap">
        SELECT
            mb.*,pi.nickName,
            pi.userName,
            pi.userPhone,
            pi.userSex,
            pi.userStatus
        FROM
            message_board mb
                LEFT JOIN personal_information pi ON mb.userId = pi.id limit #{start} ,#{pageSize}
    </select>

    <select id="queryForMessageBoardTotalCount" resultType="int" >
        select count(1) from message_board;
    </select>

    <insert id="addMessageBoardInfo" parameterType="messageBoard">
        insert into message_board(userId,messageInfo,shopBack,messageTime,backTime)
        VALUES(#{userId},#{messageInfo},#{shopBack},now(),now())
    </insert>

    <update id="updateMessageBoardInfoById" parameterType="messageBoard">
        update message_board
        <set>
            <if test="''!=userId and null!=userId">
                userId=#{userId},
            </if>
            <if test="''!=messageInfo and null!=messageInfo">
                messageInfo=#{messageInfo},
            </if>
            <if test="''!=shopBack and null!=shopBack">
                shopBack=#{shopBack},
            </if>
            <if test="''!=messageTime and null!=messageTime">
                messageTime=#{messageTime},
            </if>
            <if test="''!=backTime and null!=backTime">
                backTime=#{backTime},
            </if>
        </set>
        where id=#{id}
    </update>

    <delete id="deleteMessageBoardInfoById" parameterType="int">
        delete from message_board where id =#{id}
    </delete>

    <delete id="deleteMessageBoardInfoBatchById" parameterType="Integer[]">
        delete from message_board where id in
        <foreach collection="messageIds" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </delete>
</mapper>